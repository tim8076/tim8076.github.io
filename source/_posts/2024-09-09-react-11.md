---
title: React Hooks (8) è‡ªè¨‚ hook
date: 2024-09-09 13:45:20
categories: React
tags: React
description: 'ä»‹ç´¹ è‡ªè¨‚ hook æ–¹å¼'
---

## å»ºç«‹ hook å‡½å¼

è‡ªè¨‚ hook çš„ç¬¬ä¸€æ­¥æ˜¯å»ºç«‹ hook å‡½å¼ï¼Œä¸‹é¢æ˜¯è¿½è¹¤æ»‘é¼ åº§æ¨™çš„ä¸€å€‹ hookï¼Œå‡½å¼æœƒå°‡å€¼å›å‚³å‡ºä¾†

``` js
const useMousePosition = () => {
  const [mouse, setMouse] = useState({});

  useEffect(() => {
    const getMouseEvent = (e) => {
      setMouse({
        x: e.clientX,
        y: e.clientY,
      })
    }

    window.addEventListener('mousemove', getMouseEvent);
    return () => window.removeEventListener('mousemove', getMouseEvent)
  }, []);

  return mouse;
}
```

## å…ƒä»¶å…§å¼•å…¥ hook

``` js
const App = () => {
  const [text, setText] = useState('');
  const mouse = useMousePosition();

  return (<>
    { mouse.x} { mouse.y }
    <input type="text" onChange={e => {
      setText(e.target.value)
    }} />
  </>)
}
```

åœ¨å…ƒä»¶å…§å³å¯ä½¿ç”¨è‡ªè¨‚ hook

## è‡ªè¨‚ hook å‘½å

è‡ªè¨‚ hook å¿…é ˆä»¥ use é–‹é ­å‘½åï¼Œä½†å¦‚æœ function è£¡é¢æ²’æœ‰ç”¨åˆ° hook çš„è©±ï¼Œä¸ç”¨ useé–‹é ­

```js
// ğŸ”´ Avoid: A Hook that doesn't use Hooks
function useSorted(items) {
  return items.slice().sort();
}

// âœ… Good: A regular function that doesn't use Hooks
function getSorted(items) {
  return items.slice().sort();
}

// âœ… Good: A Hook that uses other Hooks
function useAuth() {
  return useContext(Auth);
}
```

## useAxios hook

å‰ç«¯å°ˆæ¡ˆå¸¸éœ€è¦æ‰“ api å–å›é ç«¯è³‡æ–™ï¼Œæˆ‘å€‘å¯ä»¥å°‡ç™¼å‡ºç¶²è·¯è«‹æ±‚çš„éç¨‹åŒ…æˆä¸€å€‹ custom hook æ–¹ä¾¿é‡è¤‡ä½¿ç”¨ã€‚é€™é‚Šæœƒä»¥axioså¥—ä»¶ç‚ºç¯„ä¾‹ã€‚


- useAxios hook ç¯„ä¾‹

``` js
// useAxios.jsx
import { useState, useEffect } from 'react';
import axios from 'axios';

axios.defaults.baseURL = 'https://jsonplaceholder.typicode.com';

/**
 fixed :
  - no need to JSON.stringify to then immediatly do a JSON.parse
  - don't use export defaults, because default imports are hard to search for
  - axios already support generic request in one parameter, no need to call specialized ones
**/
export const useAxios = (axiosParams) => {
    const [response, setResponse] = useState(undefined);
    const [error, setError] = useState('');
    const [loading, setloading] = useState(true);

    const fetchData = async (params) => {
      try {
       const result = await axios.request(params);
       setResponse(result.data);
       } catch( error ) {
         setError(error);
       } finally {
         setLoading(false);
       }
    };

    useEffect(() => {
        fetchData(axiosParams);
    }, []); // execute once only

    return { response, error, loading };
};
```

useAxiosHook å°‡å–çš„é ç«¯è³‡æ–™çš„é‚è¼¯åŒ…è£åœ¨ useAxios.jsx å…ƒä»¶ä¸­ï¼Œä¸¦å°‡å–å¾—è³‡æ–™å¾Œçš„ç‹€æ…‹ return å‡ºä¾† `response, error, loading`;

- ä½¿ç”¨ useAxios hook

``` jsx
import { useAxios } from 'axioshook';

const App = () => {
    const { response, loading, error } = useAxios({
        method: 'POST',
        url: '/posts',
        headers: { // no need to stringify
          accept: '*/*'
        },
        data: {  // no need to stringify
            userId: 1,
            id: 19392,
            title: 'title',
            body: 'Sample text',
        },
    });

    return (
        <div className='App'>
            <h1>Posts</h1>

            {loading ? (
                <p>loading...</p>
            ) : (
                <div>
                    {error && (
                        <div>
                            <p>{error.message}</p>
                        </div>
                    )}
                    <div> {
                      // no need to use another state to store data, response is sufficient
                      response && <p>{response.id}</p>
                    }
                    </div>
                </div>
            )}
        </div>
    );
};
```

## useToggle

å°ˆæ¡ˆä¸­ä¹Ÿå¸¸ç”¨åˆ°è¦åˆ‡æ› true å’Œ false çš„æƒ…å½¢ï¼Œå¯ä»¥æŠŠåˆ‡æ›çš„é‚è¼¯åŒ…æˆ hook

``` jsx
// useToggle.jsx
import { useState } from "react";

export default function useToggle(defaultValue) {
  const [value, setValue] = useState(defaultValue);
  function toggleValue(value) {
    setValue(currentValue => {
      return typeof value === 'boolean' ? value : !currentValue;
    })
  }
  return [value, toggleValue];
}
```

åœ¨å…ƒä»¶ä¸­ä½¿ç”¨ï¼Œç•¶ toggleValue æ²’æœ‰å‚³å…¥åƒæ•¸æ™‚ï¼Œå°±åˆ‡æ› valueï¼Œæœ‰å‚³å…¥ true æˆ– falseï¼Œå°±å¥—ç”¨ trueæˆ– falseã€‚

``` jsx
import useToggle from "./useToggle";

export default function ToggleComponent() {
  const [value, toggleValue] = useToggle(false);
  return (
    <div>
      <div>{value.toString()}</div>
      <button onClick={toggleValue}>Toggle</button>
      <button onClick={() => toggleValue(true)}>Make true</button>
      <button onClick={() => toggleValue(false)}>Make false</button>
    </div>
  )
}
```

## useFormInput

react ä¸­è¡¨å–®æ“ä½œçš„é‚è¼¯ä¹Ÿå¯ä»¥åŒ…æˆ hook

```jsx
export function useFormInput(initialValue) {
  const [value, setValue] = useState(initialValue);

  function handleChange(e) {
    setValue(e.target.value);
  }
  const inputProps = {
    value: value,
    onChange: handleChange
  };
  return inputProps;
}
```

å¯¦éš›ä½¿ç”¨

```jsx
export default function Form() {
  const firstNameProps = useFormInput('Mary');
  const lastNameProps = useFormInput('Poppins');
  return (
    <>
      <label>
        First name:
        <input {...firstNameProps} />
      </label>
      <label>
        Last name:
        <input {...lastNameProps} />
      </label>
      <p><b>Good morning, {firstNameProps.value} {lastNameProps.value}.</b></p>
    </>
  );
}
```


## useTimeout

[useTimeoutHook](https://github.com/tim8076/react-custom-hooks/blob/main/src/hooks/useTimeout/useTimeout.jsx)

é€™æ®µä»£ç¢¼æ˜¯ä¸€å€‹è‡ªå®šç¾©çš„ React Hookï¼Œç¨±ç‚º useTimeoutã€‚å®ƒç”¨ä¾†è™•ç†å»¶é²åŸ·è¡Œçš„åŠŸèƒ½ï¼Œä¸¦æä¾›è¨­ç½®ï¼ˆsetï¼‰ã€æ¸…é™¤ï¼ˆclearï¼‰å’Œé‡ç½®ï¼ˆresetï¼‰è¨ˆæ™‚å™¨çš„èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯ä»£ç¢¼çš„é‚è¼¯åˆ†è§£ï¼š

1. åƒæ•¸èˆ‡è®Šæ•¸åˆå§‹åŒ–ï¼š
   
- useTimeout(callback, delay) æ¥æ”¶å…©å€‹åƒæ•¸ï¼š
  - callbackï¼šç•¶è¨ˆæ™‚å™¨åˆ°é” delay æ™‚è¦åŸ·è¡Œçš„å‡½æ•¸ã€‚
  - delayï¼šè¨­å®šå»¶é²æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰ã€‚
- callbackRef å’Œ timeoutRef æ˜¯å…©å€‹ useRef å¼•ç”¨ï¼Œç”¨æ–¼ä¿å­˜ callback å‡½æ•¸å’Œè¨ˆæ™‚å™¨çš„ IDï¼Œç¢ºä¿å®ƒå€‘åœ¨ Hook ä¸­ä¿æŒä¸€è‡´ã€‚

2. è¨­å®šè¨ˆæ™‚å™¨ (set)ï¼š

- set æ˜¯ä¸€å€‹é€é useCallback å„²å­˜çš„å‡½æ•¸ï¼Œç”¨ä¾†è¨­ç½®è¨ˆæ™‚å™¨ã€‚
- ç•¶ set è¢«èª¿ç”¨æ™‚ï¼Œå®ƒæœƒæ ¹æ“š delay ä½¿ç”¨ setTimeout ä¾†åŸ·è¡Œ callbackRef.current()ã€‚
- [delay] ç‚ºä¾è³´é …ï¼Œç•¶ delay æ”¹è®Šæ™‚é‡æ–°ç”Ÿæˆ setã€‚

3. æ¸…é™¤è¨ˆæ™‚å™¨ (clear)ï¼š

- clear ä¹Ÿæ˜¯ç”¨ useCallback å„²å­˜çš„å‡½æ•¸ï¼Œç”¨ä¾†æ¸…é™¤è¨ˆæ™‚å™¨ã€‚
- å®ƒæª¢æŸ¥ timeoutRef.current æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å‰‡ä½¿ç”¨ clearTimeout ä¾†æ¸…é™¤è¨ˆæ™‚å™¨ã€‚

4. è‡ªå‹•åŸ·è¡Œ set å’Œæ¸…é™¤è¨ˆæ™‚å™¨ï¼š

- åœ¨ç¬¬äºŒå€‹ useEffect ä¸­ï¼ŒåŸ·è¡Œ set ä¾†å•Ÿå‹•è¨ˆæ™‚å™¨ï¼Œä¸¦è¿”å› clear ä½œç‚ºæ¸…ç†å‡½æ•¸ï¼Œç¢ºä¿ç•¶ delayã€set æˆ– clear æ”¹è®Šæ™‚å¯ä»¥è‡ªå‹•æ¸…é™¤è¨ˆæ™‚å™¨ä¸¦é‡æ–°è¨­ç½®ã€‚
- [delay, set, clear] ç‚ºä¾è³´é …ï¼Œç•¶é€™äº›å€¼è®ŠåŒ–æ™‚æœƒé‡æ–°åŸ·è¡Œ useEffectã€‚

5. é‡ç½®è¨ˆæ™‚å™¨ (reset)ï¼š

- reset æ˜¯ä¸€å€‹ useCallback å„²å­˜çš„å‡½æ•¸ï¼Œå…ˆæ¸…é™¤è¨ˆæ™‚å™¨ï¼Œå†é‡æ–°è¨­ç½®è¨ˆæ™‚å™¨ã€‚
- [clear, set] ç‚ºä¾è³´é …ï¼Œç•¶ clear æˆ– set æ”¹è®Šæ™‚ï¼Œé‡ç½®å‡½æ•¸ä¹Ÿæœƒé‡æ–°ç”Ÿæˆã€‚

6. å›å‚³ reset å’Œ clearï¼š

æœ€å¾Œï¼ŒuseTimeout å›å‚³ reset å’Œ clear å‡½æ•¸ï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨é€™å€‹ Hook çš„çµ„ä»¶ä¸­å¯ä»¥èª¿ç”¨é€™å…©å€‹å‡½æ•¸ä¾†æ‰‹å‹•æ§åˆ¶è¨ˆæ™‚å™¨ã€‚